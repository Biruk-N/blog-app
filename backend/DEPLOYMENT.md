# Backend Deployment Guide - Blog App API to Render

## 🚀 Quick Deploy with render.yaml

### Option 1: One-Click Deploy (Recommended)
1. Fork or clone this repository
2. Go to [Render Dashboard](https://dashboard.render.com/)
3. Click "New" → "Blueprint"
4. Connect your GitHub repository (select the backend folder)
5. Render will automatically detect the `render.yaml` file
6. Click "Apply" to deploy the API service and database

### Option 2: Manual Deploy

#### Step 1: Create PostgreSQL Database
1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New" → "PostgreSQL"
3. Choose "Free" plan
4. Name: `blog-app-db`
5. Database: `blogapp`
6. User: `blogapp`
7. Note down the connection details

#### Step 2: Deploy Web Service
1. Click "New" → "Web Service"
2. Connect your GitHub repository (select the backend folder)
3. Configure:
   - **Name**: `blog-app-backend`
   - **Environment**: `Docker`
   - **Dockerfile Path**: `./Dockerfile`
   - **Docker Context**: `.`
   - **Plan**: Free

#### Step 3: Set Environment Variables
Add these environment variables in the web service settings:

```
DEBUG=false
SECRET_KEY=<generate-a-secure-secret-key>
DB_NAME=blogapp
DB_USER=blogapp
DB_PASSWORD=<from-database-connection>
DB_HOST=<from-database-connection>
DB_PORT=5432
CORS_ALLOWED_ORIGINS=*
ALLOWED_HOSTS=.onrender.com
```

## 🔧 Environment Variables

### Required Variables:
- `DEBUG`: Set to `false` for production
- `SECRET_KEY`: Django secret key (auto-generated by Render)
- `DB_NAME`: PostgreSQL database name
- `DB_USER`: PostgreSQL username
- `DB_PASSWORD`: PostgreSQL password
- `DB_HOST`: PostgreSQL host
- `DB_PORT`: PostgreSQL port (usually 5432)

### Optional Variables:
- `CORS_ALLOWED_ORIGINS`: Comma-separated list of allowed origins
- `ALLOWED_HOSTS`: Comma-separated list of allowed hosts
- `EMAIL_HOST`: SMTP host for email functionality
- `EMAIL_PORT`: SMTP port
- `EMAIL_HOST_USER`: SMTP username
- `EMAIL_HOST_PASSWORD`: SMTP password

## 📁 Project Structure for Deployment

```
backend/
├── Dockerfile
├── requirements.txt
├── .dockerignore
├── build.sh
├── render.yaml
├── DEPLOYMENT.md
└── blog_backend/
    ├── settings.py
    ├── urls.py
    └── ...
```

## 🔍 Post-Deployment Checklist

1. **Database Migration**: Ensure migrations run successfully
2. **Static Files**: Verify static files are collected
3. **API Endpoints**: Test the API endpoints
4. **Authentication**: Test JWT authentication
5. **CORS**: Verify CORS is working for frontend
6. **Environment Variables**: Check all variables are set correctly

## 🧪 Testing the Deployment

### API Root
```
GET https://your-app-name.onrender.com/api/
```

### Authentication
```
POST https://your-app-name.onrender.com/api/token/
POST https://your-app-name.onrender.com/api/users/
```

### Health Check
```
GET https://your-app-name.onrender.com/api/users/
```

## 🐛 Troubleshooting

### Common Issues:

1. **Database Connection Error**
   - Check environment variables
   - Verify database is running
   - Check network connectivity

2. **Static Files Not Loading**
   - Ensure `collectstatic` runs during build
   - Check `STATIC_ROOT` setting
   - Verify WhiteNoise middleware is enabled

3. **CORS Issues**
   - Check `CORS_ALLOWED_ORIGINS` setting
   - Verify frontend domain is included
   - Test with browser developer tools

4. **Migration Errors**
   - Check database permissions
   - Verify database exists
   - Run migrations manually if needed

### Debug Mode
For debugging, temporarily set `DEBUG=true` in environment variables.

## 🔒 Security Notes

- Never commit `.env` files to version control
- Use strong, unique `SECRET_KEY`
- Set `DEBUG=false` in production
- Configure proper CORS origins
- Use HTTPS in production (handled by Render)

## 📞 Support

If you encounter issues:
1. Check Render logs in the dashboard
2. Verify all environment variables are set
3. Test locally with Docker first
4. Check Django documentation for specific errors 